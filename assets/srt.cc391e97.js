import"./index.a8e54022.js";import{_ as e,F as t,r as s,b as i,c as l,e as a,w as n,f as r,v as o,g as d,o as c,t as g,h,i as m,j as u,n as p,a as f,d as v}from"./vendor.510b2d71.js";const y={data:()=>({srt1:{file:"",selecteLine:"",loading:!1,items:[]},srt2:{file:"",loading:!1,items:[]},dirtyData:!1,dataSaving:!1}),filters:{classFilter:e=>e?"bg-hightlight":"bg-purple"},created(){let e=this;null!=localStorage.getItem("tmp-data")&&(this.srt1.loading=!0,this.srt2.loading=!0),setTimeout((function(){e.recoverTempSave()}),1e3)},methods:{chooseFile1(e){document.querySelector("#file1").click()},chooseFile2(e){document.querySelector("#file2").click()},async selectFile1(t){this.srt1.file=t.target.files[0].name;let s=await this.readFile(t.target.files[0]);let i=(new e).fromSrt(s);this.srt1.items=[],this.srt1.loading=!0,this._loadSrt1DataByPager(i)},async selectFile2(t){this.srt2.file=t.target.files[0].name;let s=await this.readFile(t.target.files[0]);let i=(new e).fromSrt(s);this.srt2.items=[],this.srt2.loading=!0,this._loadSrt2DataByPager(i)},getClassName:e=>e?"bg-hightlight":"bg-purple",selectLine(e){for(let t=0;t<this.srt1.items.length;t++){const s=this.srt1.items[t];s.id==e?(s.selected=!0,this.srt1.selecteLine=t):s.selected=!1}},addLine(e){this.srt2.items.splice(e+1,0,{id:"0",startTime:"00:00:00,000",endTime:"00:00:00,000",text:""}),this.dirtyData=!0},deleteLine(e){this.srt2.items.splice(e,1),this.dirtyData=!0},replaceLine(e){""!==this.srt1.selecteLine?(this.srt1.items[this.srt1.selecteLine].text=e.text,this.srt1.selecteLine+1<this.srt1.items.length&&(this.srt1.items[this.srt1.selecteLine].selected=!1,this.srt1.selecteLine++,this.srt1.items[this.srt1.selecteLine].selected=!0),this.dirtyData=!0):ElMessage.warning({message:"左侧未选中需替换字幕",type:"warning"})},recoverTempSave(){let e=this,t=localStorage.getItem("tmp-data");t&&(t=JSON.parse(t),t.srt1?(this.srt1.file=t.srt1.file,this.srt1.selecteLine=t.srt1.selecteLine,this._loadSrt1DataByPager(t.srt1.items)):this.srt1.loading=!1,t.srt2?(this.srt2.file=t.srt2.file,this.srt2.selecteLine=t.srt2.selecteLine,this._loadSrt2DataByPager(t.srt2.items)):this.srt2.loading=!1),setInterval((function(){e.dirtyData&&!e.dataSaving&&e.srt1.items.length>0&&e.srt2.items.length>0&&(e.dataSaving=!0,setTimeout((()=>{let t=JSON.stringify({srt1:e.srt1,srt2:e.srt2});localStorage.setItem("tmp-data",t),e.dirtyData=!1}),100),setTimeout((()=>{e.dataSaving=!1}),2e3))}),1e4)},onInputChange(){console.log("change"),this.dirtyData=!0},saveToFile(){let e=this,s="";for(let t=0;t<e.srt1.items.length;t++){const i=e.srt1.items[t];s+=`${t+1}\n${i.startTime} --\x3e ${i.endTime}\n${i.text}\n\n`}let i=new window.Blob([s],{type:"text/plain;charset=utf-8"});t.exports.saveAs(i,e.srt1.file.replace(/\.[^/.]+$/,"")+".edited.srt")},_loadSrt1DataByPager(e){let t=this,s=Math.floor(e.length/20);for(let i=0;i<s;i++){let l=e.splice(0,20);setTimeout((function(){t.srt1.items.push(...l),i+1==s&&(t.srt1.loading=!1,console.log("srt1临时数据还原完成."))}),100)}},_loadSrt2DataByPager(e){let t=this,s=Math.floor(e.length/20);for(let i=0;i<s;i++){let l=e.splice(0,20);setTimeout((function(){t.srt2.items.push(...l),i+1==s&&(t.srt2.loading=!1,console.log("srt2临时数据还原完成."))}),100)}},readFile:function(e){return new Promise(((t,s)=>{let i=new FileReader;i.onload=function(e){let s=e.target.result;t(s)},i.onerror=function(e){s(e)},i.readAsText(e)}))}}},C={id:"container"},S={class:"toolbar"},L=u("请选择字幕文件(.srt)"),k=u("导出修改"),x={class:"grid-content"},w={class:"loading","element-loading-text":"编辑数据加载中...","element-loading-spinner":"el-icon-loading"},F=["onClick"],T={class:"line-id"},_={class:"line-time"},b={class:"line-text"},D={class:"toolbar"},V=u("请选择字幕文件(.srt)"),B={class:"grid-content"},P={class:"loading","element-loading-text":"编辑数据加载中...","element-loading-spinner":"el-icon-loading"},j={class:"line-id"},I=["onClick"],$=["onClick"],N=["onClick"],U={class:"line-time"},z={class:"line-text"},M={class:"saving-state"};y.render=function(e,t,f,v,y,q){const A=s("el-button"),J=s("el-input"),O=s("el-col"),E=s("el-row"),R=s("el-backtop"),G=i("loading");return c(),l("div",C,[a(E,null,{default:n((()=>[a(O,{span:12},{default:n((()=>[d("div",S,[a(A,{size:"small",type:"success",onClick:q.chooseFile1},{default:n((()=>[L])),_:1},8,["onClick"]),r(d("span",{class:"file-name"},"("+g(y.srt1.file)+")",513),[[o,y.srt1.file]]),r(d("input",{id:"file1",type:"file",onChange:t[0]||(t[0]=(...e)=>q.selectFile1&&q.selectFile1(...e))},null,544),[[o,!1]]),a(A,{type:"primary",onClick:q.saveToFile,icon:"el-icon-download",size:"small"},{default:n((()=>[k])),_:1},8,["onClick"])]),d("div",x,[r(d("div",w,null,512),[[G,y.srt1.loading],[o,y.srt1.loading]]),(c(!0),l(h,null,m(y.srt1.items,(e=>(c(),l("div",{class:p(["line bg-purple",q.getClassName(e.selected)]),key:e.id,onClick:t=>q.selectLine(e.id)},[d("div",T,g(e.id),1),d("div",_,g(e.startTime)+" ~ "+g(e.endTime),1),d("div",b,[a(J,{type:"textarea",rows:2,placeholder:"请输入内容",onChange:q.onInputChange,modelValue:e.text,"onUpdate:modelValue":t=>e.text=t},null,8,["onChange","modelValue","onUpdate:modelValue"])])],10,F)))),128))])])),_:1}),a(O,{span:12},{default:n((()=>[d("div",D,[a(A,{size:"small",type:"success",onClick:q.chooseFile2},{default:n((()=>[V])),_:1},8,["onClick"]),r(d("span",{class:"file-name"},"("+g(y.srt1.file)+")",513),[[o,y.srt1.file]]),r(d("input",{id:"file2",type:"file",onChange:t[1]||(t[1]=(...e)=>q.selectFile2&&q.selectFile2(...e))},null,544),[[o,!1]])]),d("div",B,[r(d("div",P,null,512),[[G,y.srt2.loading],[o,y.srt2.loading]]),(c(!0),l(h,null,m(y.srt2.items,((e,t)=>(c(),l("div",{class:"line bg-purple-light",key:e.id},[d("div",j,[a(E,{gutter:20},{default:n((()=>[a(O,{span:8},{default:n((()=>[u(g(t+1)+"-("+g(e.id)+")",1)])),_:2},1024),a(O,{class:"operate",span:16},{default:n((()=>[d("a",{href:"javascript:;",onClick:t=>q.replaceLine(e)},"<<替换",8,I),d("a",{href:"javascript:;",onClick:e=>q.addLine(t)},"增加",8,$),d("a",{href:"javascript:;",onClick:e=>q.deleteLine(t)},"删除",8,N)])),_:2},1024)])),_:2},1024)]),d("div",U,g(e.startTime)+" ~ "+g(e.endTime),1),d("div",z,[a(J,{type:"textarea",rows:2,placeholder:"请输入内容",modelValue:e.text,"onUpdate:modelValue":t=>e.text=t},null,8,["modelValue","onUpdate:modelValue"])])])))),128))])])),_:1})])),_:1}),a(R),r(d("div",M,"数据保存中...",512),[[o,y.dataSaving]])])},window.onbeforeunload=function(){return"确认离开页面?!"};const q=f(y);q.use(v),q.mount("#app");
