import"./index.a8e54022.js";import{_ as e,E as t,F as s,r as i,b as l,c as a,e as n,w as r,f as o,v as d,g as c,o as h,t as g,h as u,i as m,j as f,n as p,a as v,d as y}from"./vendor.49f19860.js";const T={data:()=>({srt1:{file:"",selecteLine:"",loading:!1,items:[]},srt2:{file:"",loading:!1,items:[]},dirtyData:!1,dataSaving:!1}),filters:{classFilter:e=>e?"bg-hightlight":"bg-purple"},created(){let e=this;null!=localStorage.getItem("tmp-data")&&(this.srt1.loading=!0,this.srt2.loading=!0),setTimeout((function(){e.recoverTempSave()}),1e3)},methods:{chooseFile1(e){document.querySelector("#file1").click()},chooseFile2(e){document.querySelector("#file2").click()},async selectFile1(t){this.srt1.file=t.target.files[0].name;let s=await this.readFile(t.target.files[0]);let i=(new e).fromSrt(s);this.srt1.items=[],this.srt1.loading=!0,this._loadSrt1DataByPager(i)},async selectFile2(t){this.srt2.file=t.target.files[0].name;let s=await this.readFile(t.target.files[0]);let i=(new e).fromSrt(s);this.srt2.items=[],this.srt2.loading=!0,this._loadSrt2DataByPager(i)},getClassName:e=>e?"bg-hightlight":"bg-purple",selectLine(e){for(let t=0;t<this.srt1.items.length;t++){const s=this.srt1.items[t];s.id==e?(s.selected=!0,this.srt1.selecteLine=t):s.selected=!1}},addLine(e){this.srt2.items.splice(e+1,0,{id:"0",startTime:"00:00:00,000",endTime:"00:00:00,000",text:""}),this.dirtyData=!0},deleteLine(e){this.srt2.items.splice(e,1),this.dirtyData=!0},replaceLine(e){""!==this.srt1.selecteLine?(this.srt1.items[this.srt1.selecteLine].text=e.text,this.srt1.selecteLine+1<this.srt1.items.length&&(this.srt1.items[this.srt1.selecteLine].selected=!1,this.srt1.selecteLine++,this.srt1.items[this.srt1.selecteLine].selected=!0),this.dirtyData=!0):t.warning({message:"左侧未选中需替换字幕",type:"warning"})},recoverTempSave(){let e=this,t=localStorage.getItem("tmp-data");t&&(t=JSON.parse(t),t.srt1?(this.srt1.file=t.srt1.file,this.srt1.selecteLine=t.srt1.selecteLine,this._loadSrt1DataByPager(t.srt1.items)):this.srt1.loading=!1,t.srt2?(this.srt2.file=t.srt2.file,this.srt2.selecteLine=t.srt2.selecteLine,this._loadSrt2DataByPager(t.srt2.items)):this.srt2.loading=!1),setInterval((function(){e.dirtyData&&!e.dataSaving&&e.srt1.items.length>0&&e.srt2.items.length>0&&(e.dataSaving=!0,setTimeout((()=>{let t=JSON.stringify({srt1:e.srt1,srt2:e.srt2});localStorage.setItem("tmp-data",t),e.dirtyData=!1}),100),setTimeout((()=>{e.dataSaving=!1}),2e3))}),1e4)},onInputChange(){console.log("change"),this.dirtyData=!0},saveToFile(){let e=this,t="";for(let s=0;s<e.srt1.items.length;s++){const i=e.srt1.items[s];t+=`${s+1}\n${i.startTime} --\x3e ${i.endTime}\n${i.text}\n\n`}let i=new window.Blob([t],{type:"text/plain;charset=utf-8"});s.exports.saveAs(i,e.srt1.file.replace(/\.[^/.]+$/,"")+".edited.srt")},_loadSrt1DataByPager(e){let t=this,s=Math.floor(e.length/20);for(let i=0;i<s;i++){let l=e.splice(0,20);setTimeout((function(){t.srt1.items.push(...l),i+1==s&&(t.srt1.loading=!1,console.log("srt1临时数据还原完成."))}),100)}},_loadSrt2DataByPager(e){let t=this,s=Math.floor(e.length/20);for(let i=0;i<s;i++){let l=e.splice(0,20);setTimeout((function(){t.srt2.items.push(...l),i+1==s&&(t.srt2.loading=!1,console.log("srt2临时数据还原完成."))}),100)}},_readText:function(e){var t=null,s=0;return e.length>1&&(254==e[0]&&255==e[1]?(t="UTF-16BE",s=2):255==e[0]&&254==e[1]&&(t="UTF-16LE",s=2)),null==t&&e.length>2&&239==e[0]&&187==e[1]&&191==e[2]&&(t="UTF8",s=3),null==t&&e.length>3&&(0==e[0]&&0==e[1]&&254==e[2]&&255==e[3]?(t="UTF-32BE",s=4):255==e[0]&&254==e[1]&&0==e[2]&&0==e[3]&&(t="UTF-32LE",s=4)),null==t&&function(e){for(var t,s=1,i=0;i<e.length;i++){if(0==(t=e[i]))throw new Error("非预期的byte格式");if(1==s){if(t>=128){for(;0!=(128&(t<<=1));)s++;if(1==s||s>6)return!1}}else{if(128!=(192&t))return!1;s--}}if(s>1)throw new Error("非预期的byte格式");return!0}(e)&&(t="UTF8"),null==t&&(t="GBK"),s>0&&(e=e.slice(s)),"GBK"==t?GBK.decode(e):new TextDecoder("utf-8").decode(e)},readFile:function(e){let t=this;return new Promise(((s,i)=>{let l=new FileReader;l.onload=function(e){let i=e.target.result,l=new Uint8Array(i),a=t._readText(l);s(a)},l.onerror=function(e){i(e)},l.readAsArrayBuffer(e)}))}}},w={id:"container"},F={class:"toolbar"},C=f("请选择字幕文件(.srt)"),L=f("导出修改"),S={class:"grid-content"},x={class:"loading","element-loading-text":"编辑数据加载中...","element-loading-spinner":"el-icon-loading"},k=["onClick"],_={class:"line-id"},b={class:"line-time"},D={class:"line-text"},B={class:"toolbar"},U=f("请选择字幕文件(.srt)"),V={class:"grid-content"},E={class:"loading","element-loading-text":"编辑数据加载中...","element-loading-spinner":"el-icon-loading"},P={class:"line-id"},j=["onClick"],I=["onClick"],$=["onClick"],A={class:"line-time"},N={class:"line-text"},z={class:"saving-state"};T.render=function(e,t,s,v,y,T){const G=i("el-button"),K=i("el-input"),q=i("el-col"),J=i("el-row"),M=i("el-backtop"),O=l("loading");return h(),a("div",w,[n(J,null,{default:r((()=>[n(q,{span:12},{default:r((()=>[c("div",F,[n(G,{size:"small",type:"success",onClick:T.chooseFile1},{default:r((()=>[C])),_:1},8,["onClick"]),o(c("span",{class:"file-name"},"("+g(y.srt1.file)+")",513),[[d,y.srt1.file]]),o(c("input",{id:"file1",type:"file",onChange:t[0]||(t[0]=(...e)=>T.selectFile1&&T.selectFile1(...e))},null,544),[[d,!1]]),n(G,{type:"primary",onClick:T.saveToFile,icon:"el-icon-download",size:"small"},{default:r((()=>[L])),_:1},8,["onClick"])]),c("div",S,[o(c("div",x,null,512),[[O,y.srt1.loading],[d,y.srt1.loading]]),(h(!0),a(u,null,m(y.srt1.items,(e=>(h(),a("div",{class:p(["line bg-purple",T.getClassName(e.selected)]),key:e.id,onClick:t=>T.selectLine(e.id)},[c("div",_,g(e.id),1),c("div",b,g(e.startTime)+" ~ "+g(e.endTime),1),c("div",D,[n(K,{type:"textarea",rows:2,placeholder:"请输入内容",onChange:T.onInputChange,modelValue:e.text,"onUpdate:modelValue":t=>e.text=t},null,8,["onChange","modelValue","onUpdate:modelValue"])])],10,k)))),128))])])),_:1}),n(q,{span:12},{default:r((()=>[c("div",B,[n(G,{size:"small",type:"success",onClick:T.chooseFile2},{default:r((()=>[U])),_:1},8,["onClick"]),o(c("span",{class:"file-name"},"("+g(y.srt1.file)+")",513),[[d,y.srt1.file]]),o(c("input",{id:"file2",type:"file",onChange:t[1]||(t[1]=(...e)=>T.selectFile2&&T.selectFile2(...e))},null,544),[[d,!1]])]),c("div",V,[o(c("div",E,null,512),[[O,y.srt2.loading],[d,y.srt2.loading]]),(h(!0),a(u,null,m(y.srt2.items,((e,t)=>(h(),a("div",{class:"line bg-purple-light",key:e.id},[c("div",P,[n(J,{gutter:20},{default:r((()=>[n(q,{span:8},{default:r((()=>[f(g(t+1)+"-("+g(e.id)+")",1)])),_:2},1024),n(q,{class:"operate",span:16},{default:r((()=>[c("a",{href:"javascript:;",onClick:t=>T.replaceLine(e)},"<<替换",8,j),c("a",{href:"javascript:;",onClick:e=>T.addLine(t)},"增加",8,I),c("a",{href:"javascript:;",onClick:e=>T.deleteLine(t)},"删除",8,$)])),_:2},1024)])),_:2},1024)]),c("div",A,g(e.startTime)+" ~ "+g(e.endTime),1),c("div",N,[n(K,{type:"textarea",rows:2,placeholder:"请输入内容",modelValue:e.text,"onUpdate:modelValue":t=>e.text=t},null,8,["modelValue","onUpdate:modelValue"])])])))),128))])])),_:1})])),_:1}),n(M),o(c("div",z,"数据保存中...",512),[[d,y.dataSaving]])])},window.onbeforeunload=function(){return"确认离开页面?!"};const G=v(T);G.use(y),G.mount("#app");
